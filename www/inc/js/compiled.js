
if(!console){console={log:function(text){}}}
pulsefeed.start=function(){console.log('[Pulsefeed] Charging up...');message.start();api.start(true);design.start();queue.start();console.log('[Pulsefeed] Charged.');}
$(document).ready(function(){pulsefeed.start();});var message={};message.start=function(){$('div.message').click(function(el){$(this).slideUp(200);});function messageslide(){$('div.message').slideUp(200);}
setTimeout(messageslide,2000);};message.add=function(message,type){$('#messages').append('<div class="message '+type+'"><div class="wrap">'+message+'<span class="right">hide message</span></div></div>');this.start();}
var api={};api.start=function(full){$('html').unbind().bind('click',function(ev){$('.item .meta .collect_button').removeClass('active');$('.item .meta form.share_form input[type=submit]').removeClass('active');$('.item .meta ul.collections').remove();$('.item .meta ul.shares').remove();$('ul#external ul.collections').remove();$('ul#external .collect_button_external').removeClass('active');$('ul#external ul.shares').remove();$('ul#external .share_form_external button').removeClass('active');$('#search_results').css('display','none');});$('.hide_form').unbind().bind('submit',function(ev){ev.preventDefault();api.read(ev.target);});$('.website_subscribe').unbind().bind('submit',function(ev){ev.preventDefault();api.subscribeWebsite(ev.target);});$('.topic_subscribe').unbind().bind('submit',function(ev){ev.preventDefault();api.subscribeTopic(ev.target);});$('.user_follow').unbind().bind('submit',function(ev){ev.preventDefault();api.follow(ev.target);});$('.collect_button').unbind().bind('click',function(ev){ev.preventDefault();ev.stopPropagation();api.collect(ev.target);});$('.uncollect_form').unbind().bind('submit',function(ev){ev.preventDefault();api.uncollect(ev.target);});$('.share_form').unbind().bind('submit',function(ev){ev.preventDefault();api.share(ev.target);});$('.share_form input[type=submit]').unbind().bind('click',function(ev){ev.stopPropagation();});if(full){$('.stream_load_more').bind('click',function(ev){ev.preventDefault();api.loadStream(ev.target,false);});$('.source_load_more').bind('click',function(ev){ev.preventDefault();api.loadSource(ev.target);});$('form#search').bind('submit',function(ev){ev.preventDefault();api.search(ev.target,0);});$('.collect_button_external').unbind().bind('click',function(ev){ev.preventDefault();ev.stopPropagation();api.collectExternal(ev.target);});$('.share_form_external').unbind().bind('submit',function(ev){ev.preventDefault();api.share(ev.target);});$('.share_form_external button').unbind().bind('click',function(ev){ev.stopPropagation();});$('.stream_images_toggle').unbind().bind('click',function(ev){ev.preventDefault();api.imageToggle(ev.target);});$('.stream_column_toggle').unbind().bind('click',function(ev){ev.preventDefault();api.columnToggle(ev.target);});$('.stream_order_toggle').unbind().bind('click',function(ev){ev.preventDefault();api.orderToggle(ev.target);});$('.stream_message_toggle').unbind().bind('click',function(ev){ev.preventDefault();api.messageToggle(ev.target);});}}
api.request=function(type,url,data,success,failure,element){$.ajax({type:type,url:mod_root+url+'?iapi',data:data,context:element,dataType:'json',success:function(data){if(!data||!data.mod_token||!data.result){failure(data,this);console.log('[Pulsefeed] API Request Failed: invalid data returned!');}else{mod_token=data.mod_token;if(data.result=='success'){success(data,this);console.log('[Pulsefeed] API Request Success: '+data.message);}else{failure(data,this);console.log('[Pulsefeed] API Request Failed: '+data.message);}}},error:function(data,text,error){failure(data,this);console.log('[Pulsefeed] API Request Failed Miserably: '+text);}});console.log('[Pulsefeed] API Request Fired: '+url);}
api.get=function(url,data,success,failure,element){this.request('GET',url,data,success,failure,element);}
api.post=function(url,data,success,failure,element){data.mod_token=mod_token;this.request('POST',url,data,success,failure,element);}
api.collections=new Array();api.collectionId=0;api.collectionArticleId=0;api.read=function(el){var article_id=$('input[name=article_id]',el).attr('value');$('input[type=submit]',el).attr('disabled','disabled');$('input[type=submit]',el).addClass('disabled');this.post('/process/article-hide',{article_id:article_id},function(data,el){var article_id=$('input[name=article_id]',el).attr('value');$('#article_'+article_id).animate({height:'toggle'},150,function(){$(this).remove();});},function(data,el){$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');},el);}
api.follow=function(el){var user_id=$('input[name=user_id]',el).attr('value');var action=$(el).attr('action');$('input[type=submit]',el).attr('disabled','disabled');$('input[type=submit]',el).addClass('disabled');if(action==mod_root+'/process/follow'){this.post('/process/follow',{user_id:user_id},function(data,el){$('input[type=submit]',el).attr('value','Unfollow');$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');$('input[type=submit]',el).removeClass('green');$('input[type=submit]',el).addClass('red');$(el).attr('action',mod_root+'/process/unfollow');},function(data,el){$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');},el);}else{this.post('/process/unfollow',{user_id:user_id},function(data,el){$('input[type=submit]',el).attr('value','+ Follow');$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');$('input[type=submit]',el).removeClass('red');$('input[type=submit]',el).addClass('green');$(el).attr('action',mod_root+'/process/follow');},function(data,el){$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');},el);}}
api.subscribeWebsite=function(el){var website_id=$('input[name=website_id]',el).attr('value');var action=$(el).attr('action');$('input[type=submit]',el).attr('disabled','disabled');$('input[type=submit]',el).addClass('disabled');if(action==mod_root+'/process/website-subscribe'){this.post('/process/website-subscribe',{website_id:website_id},function(data,el){$('input[type=submit]',el).attr('value','Unsubscribe');$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');$('input[type=submit]',el).removeClass('green');$('input[type=submit]',el).addClass('red');$(el).attr('action',mod_root+'/process/website-unsubscribe');},function(data,el){$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');},el);}else{this.post('/process/website-unsubscribe',{website_id:website_id},function(data,el){$('input[type=submit]',el).attr('value','+ Subscribe');$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');$('input[type=submit]',el).removeClass('red');$('input[type=submit]',el).addClass('green');$(el).attr('action',mod_root+'/process/website-subscribe');},function(data,el){$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');},el);}}
api.subscribeTopic=function(el){var topic_id=$('input[name=topic_id]',el).attr('value');var action=$(el).attr('action');$('input[type=submit]',el).attr('disabled','disabled');$('input[type=submit]',el).addClass('disabled');if(action==mod_root+'/process/topic-subscribe'){this.post('/process/topic-subscribe',{topic_id:topic_id},function(data,el){$('input[type=submit]',el).attr('value','Unsubscribe');$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');$('input[type=submit]',el).removeClass('green');$('input[type=submit]',el).addClass('red');$(el).attr('action',mod_root+'/process/topic-unsubscribe');},function(data,el){$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');},el);}else{this.post('/process/topic-unsubscribe',{topic_id:topic_id},function(data,el){$('input[type=submit]',el).attr('value','+ Subscribe');$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');$('input[type=submit]',el).removeClass('red');$('input[type=submit]',el).addClass('green');$(el).attr('action',mod_root+'/process/topic-subscribe');},function(data,el){$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');},el);}}
api.collect=function(el,noloop){if($('ul.collections',$(el).parent()).length>0){$('.item .meta .collect_button').removeClass('active');$('.item .meta form.share_form input[type=submit]').removeClass('active');$('.item .meta ul.collections').remove();$('.item .meta ul.shares').remove();return;}
$('.item .meta ul.collections').remove();$('.item .meta ul.shares').remove();$('.item .meta .collect_button').removeClass('active');$('.item .meta form.share_form input[type=submit]').removeClass('active');var id=$(el).attr('data-articleid');this.collectionArticleId=id;if(this.collections.length<=0&&!noloop){$(el).addClass('disabled');this.get('/article/'+id+'/collect',{},function(data,el){$(el).removeClass('disabled');api.collections=data.collections;api.collect(el,true);},function(data,el){window.location=mod_root+'/article/'+this.collectionArticleId+'/collect';},el);return;}
$(el).addClass('active');$(el).parent().append('<ul class="collections"><span class="tip"></span></ul>');var ul=$('ul.collections',$(el).parent());for(var i=0;i<this.collections.length;i++){ul.append('<li><a href="'+mod_root+'/article/'+id+'/collect" data-collectionid="'+this.collections[i].id+'" data-articleid="'+id+'" class="submit_collect">'+this.collections[i].name+'</a> <span class="edit inline">'+this.collections[i].articles+' articles</span>');}
ul.append('<li><form action="'+mod_root+'/article/'+id+'/collect" class="submit_collect" data-articleid="'+id+'" data-collectionid="0"><input class="meta" type="text" value="new collection..." onclick="if( this.value == \'new collection...\' ) { this.value = \'\'; }" onblur="if( this.value == \'\' ) { this.value = \'new collection...\'; }" /></form></li>');ul.css({marginTop:-1*(ul.height()+30)});$('.tip',ul).css({marginTop:ul.height()+5});$('a.submit_collect').bind('click',function(ev){ev.preventDefault();api.collectArticle(ev.target);});$('form.submit_collect').bind('submit',function(ev){ev.preventDefault();api.collectArticle(ev.target);});$('.item .meta ul.collections').bind('click',function(ev){ev.stopPropagation();});}
api.collectArticle=function(el){var art_id=$(el).attr('data-articleid');var col_id=$(el).attr('data-collectionid');var name='';if(col_id==0){var name=$('input[type=text]',el).attr('value');if(name.length<=0){return;}}
this.collectionId=col_id;this.collectionArticleId=art_id;this.post('/process/article-collect',{collection_name:name,collection_id:col_id,article_id:art_id},function(data,el){var span=$('span',$(el).parent());var ul=$(el).parent().parent();span.html('added');if($(el).attr('data-collectionid')>0){$(el).addClass('disabled');}else{$(el).parent().before('<li class="new_collection" style="display:none;">'+$('input[type=text]',el).attr('value')+' <span class="edit inline">1 article</span></li>');$('input[type=text]',el).attr('value','');$('li.new_collection',ul).slideDown(300);ul.animate({marginTop:-1*(ul.height()+52)},300);$('.tip',ul).animate({marginTop:ul.height()+28},300);}
if(api.collectionId==0){api.collections=new Array();}},function(data,el){window.location=mod_root+'/article/'+api.collectionArticleId+'/collect';},el);}
api.uncollect=function(el){var article_id=$('input[name=article_id]',el).attr('value');var collection_id=$('input[name=collection_id]',el).attr('value');$('input[type=submit]',el).attr('disabled','disabled');$('input[type=submit]',el).addClass('disabled');this.post('/process/article-uncollect',{article_id:article_id,collection_id:collection_id},function(data,el){var article_id=$('input[name=article_id]',el).attr('value');$('#article_'+article_id).animate({height:'toggle'},150,function(){$(this).remove();});},function(data,el){$('input[type=submit]',el).removeAttr('disabled');$('input[type=submit]',el).removeClass('disabled');},el);}
api.share=function(el){if($('.shares',$(el).parent()).length>0){$('.item .meta form.share_form input[type=submit]').removeClass('active');$('.item .meta form.share_form input[type=submit]').removeClass('disabled');$('.item .meta .collect_button').removeClass('active');$('.item .meta ul.shares').remove();$('.item .meta ul.collections').remove();return;}
$('.item .meta ul.shares').remove();$('.item .meta ul.collections').remove();$('.item .meta form.share_form input[type=submit]').removeClass('active');$('.item .meta .collect_button').removeClass('active');var id=$('input[name=article_id]',el).attr('value');var fb_shares=$('input[name=facebook_shares]',el).attr('value');var tw_links=$('input[name=twitter_links]',el).attr('value');$('input[type=submit]',$(el)).addClass('active');$('input[type=submit]',$(el)).removeClass('disabled');$('span.share',el).append('<ul class="shares"></ul>');var ul=$('.shares',$(el).parent());var title=$('input[name=article_title]',el).attr('value');var url=$('input[name=article_url]',el).attr('value');ul.append('<li><span>'+tw_links+'</span> <a href="javascript:var w=window.open( \'https://twitter.com/share?via=pulsefeed&url='+url+'&text='+title+'\', \'test\', \'menubar=0,resizable=0,width=700,height=300\' );w.moveTo($(window).width()/2-350,$(window).height()/2-150);" target="_blank" class="button twitter">+ Twitter</a></li>');ul.append('<li><span>'+fb_shares+'</span> <a href="javascript:var w=window.open( \'http://www.facebook.com/sharer.php?u='+url+'&t='+title+'\', \'test\', \'menubar=0,resizable=0,width=700,height=300\' );w.moveTo($(window).width()/2-350,$(window).height()/2-150);" target="_blank" class="button facebook">+ Facebook</a></li>');ul.append('<li class="form"><input type="checkbox" name="share_to_followers" id="share_to_followers" /><label for="share_to_followers">share to followers</label></li><span class="tip"></span>');this.post('/process/article-share',{article_id:id},function(data,el){$(el).attr('checked','checked');},function(data,el){},$('ul.shares #share_to_followers'));$('ul.shares #share_to_followers').bind('click',function(ev){api.unshare(ev.target);ev.preventDefault();});$('ul.shares').bind('click',function(ev){ev.stopPropagation();});}
api.unshare=function(el){$(el).addClass('disabled');var id=$('input[name=article_id]',$(el).parent().parent().parent().parent()).attr('value');this.post('/process/article-'+(!$(el).attr('checked')?'un':'')+'share',{article_id:id},function(data,el){!$(el).attr('checked')?$(el).attr('checked','checked'):$(el).removeAttr('checked');$(el).removeClass('disabled');},function(data,el){},el);}
api.imageToggle=function(el){if(cookie.get('hide_images')){cookie.delete('hide_images');$(el).html('Images: on<span>hide images in the stream<span></span></span>');$(el).addClass('green').removeClass('red');$('.col1 .item img.thumb').fadeIn();$('.col2 .item img.thumb').fadeIn();if($('#stream').hasClass('evencol')){$('.col3 .item img.thumb').fadeIn();}}else{cookie.set('hide_images',true);$(el).html('Images: off<span>show images in the stream<span></span></span>');$(el).addClass('red').removeClass('green');$('.item img.thumb').fadeOut();}}
api.columnToggle=function(el){if(cookie.get('two_col')){cookie.delete('two_col');$(el).html('Columns: 3<span>switch between 2 &amp; 3 columns<span></span></span>');$('#stream').removeClass('twocol');}else{cookie.set('two_col',true);$(el).html('Columns: 2<span>switch between 2 &amp; 3 columns<span></span></span>');$('#stream').addClass('twocol');}}
api.messageToggle=function(el){if(cookie.get('hide_message')){cookie.delete('hide_message');$(el).html('Hide Message<span>hide the login message<span></span></span>');$(el).addClass('red').removeClass('green');$('.welcome').slideDown();}else{cookie.set('hide_message',true);$(el).html('Show Message<span>show the login message<span></span></span>');$(el).addClass('green').removeClass('red');$('.welcome ').slideUp();}}
api.searchTerm='';api.searchActive=0;api.search=function(el,off){api.searchActive=1;var query=$('input[type=text]',el).attr('value');api.searchTerm=query;$('input[type=submit]',el).css('background-image','url( '+mod_root+'/inc/img/icons/loader.gif )');$('input[type=text]',el).focus();api.get('/search',{q:query,offset:off},function(data,el){$('#search_results').html('');if(data.sources.length>0){$('#search_results').append('<li class="title">Sources</li>');for(var i=0;i<data.sources.length;i++){$('#search_results').append('<li class="search_source'+(i>=3?' hidden':'')+'"><a href="'+mod_root+'/website/'+data.sources[i].id+'"><span class="title"><img src="http://favicon.fdev.in/'+data.sources[i].domain+'"/> '+data.sources[i].title+'</span><span class="type">website / '+data.sources[i].url+'</span></a></li>');}
if(data.sources.length>3){$('#search_results').append('<li class="more"><a href="#" class="show_more_sources"><strong>show more sources &darr;</strong></a></li>')}}
if(data.users.length>0){$('#search_results').append('<li class="title">Users</li>');for(var i=0;i<data.users.length;i++){$('#search_results').append('<li class="search_user"><a href="'+mod_root+'/user/'+data.users[i].id+'"><span class="title">'+(data.users[i].avatar.length>0?'<img src="'+data.users[i].avatar+'"/>':'')+data.users[i].title+'</span><span class="type">user</span></a></li>');}}
if(data.articles.length>0){$('#search_results').append('<li class="title">Articles</li>');for(var i=0;i<data.articles.length;i++){$('#search_results').append('<li class="search_article"><a href="'+mod_root+'/article/'+data.articles[i].id+'"><span class="title">'+(data.articles[i].source?'<img src="http://favicon.fdev.in/'+data.articles[i].source.domain+'"/>':'')+data.articles[i].title+'</span><span class="type">article'+(data.articles[i].source?' from '+data.articles[i].source.title:'')+' - '+data.articles[i].time_ago+'</span></a></li>');}}
resultslength=data.sources.length+data.users.length+data.articles.length;if(resultslength<=0){$('#search_results').append('<li class="title">We couldn\'t find anything :(</li>');}else{$('#search_results').append('<li class="more"><a href="#" class="load_more_search"><strong>load more results &darr;</strong></a></li>');$('.load_more_search').bind('click',function(ev){ev.preventDefault();api.search(el,data.nextOffset);})
$('.show_more_sources').bind('click',function(ev){ev.preventDefault();$('.search_source.hidden').fadeIn();api.searchActive=true;$(ev.target).parent().remove();});}
$('input[type=submit]',el).css('background-image','url( '+mod_root+'/inc/img/icons/search.png )');$('#search_results').css('display','block');$('#search_results').scrollTop(0);$('#search_results').bind('click',function(ev){ev.stopPropagation();});$('form#search').bind('click',function(ev){ev.stopPropagation();});},function(data,el){window.location=mod_root+'/search?q='+api.searchTerm;},el);}
api.collectExternal=function(el,noloop){if($('.collections',$(el).parent()).length>0){$(el).removeClass('active');return $('ul.collections').remove();}
var id=$('.collect_button_external').attr('data-articleid');this.collectionArticleId=id;if(this.collections.length<=0&&!noloop){$(el).addClass('disabled');this.get('/article/'+id+'/collect',{},function(data,el){$(el).removeClass('disabled');api.collections=data.collections;api.collectExternal(el,true);},function(data,el){console.log($(el).attr('href'));},el);return;}
$(el).addClass('active');$(el).parent().prepend('<ul class="collections"><span class="tip"></span></ul>');var ul=$('.collections',$(el).parent());for(var i=0;i<this.collections.length;i++){ul.append('<li><a href="'+mod_root+'/article/'+id+'/collect" data-collectionid="'+this.collections[i].id+'" data-articleid="'+id+'" class="submit_collect">'+this.collections[i].name+' <span class="edit inline">'+this.collections[i].articles+' articles</span></a>');}
ul.append('<li><form action="'+mod_root+'/article/'+id+'/collect" class="submit_collect" data-articleid="'+id+'" data-collectionid="0"><input type="text" value="new collection..." onclick="if( this.value == \'new collection...\' ) { this.value = \'\'; }" onblur="if( this.value == \'\' ) { this.value = \'new collection...\'; }" /></form></li>');$('a.submit_collect').bind('click',function(ev){ev.preventDefault();api.collectArticle(ev.target);});$('form.submit_collect').bind('submit',function(ev){ev.preventDefault();api.collectArticle(ev.target);});$('ul#external ul.collections').bind('click',function(ev){ev.stopPropagation();});}
api.shareExternal=function(el){console.log(el);}
api.loadSource=function(el){$(el).html('loading <img src="'+mod_root+'/inc/img/icons/loader.gif" alt="" />');this.get('/'+pulsefeed.sourceType+'s',{offset:pulsefeed.sourceOffset},function(data,el){if(data.result=='success'){if(data.sources==null||data.sources.length==0){$(el).html('no more '+pulsefeed.sourceType+'s :(');$(el).removeClass('source_load_more');$(el).unbind('click');$(el).bind('click',function(ev){ev.preventDefault();});$(el).addClass('disabled');return;}else{for(var i=0;i<data.sources.length;i++){$('.sources').append(template.source(data.sources[i],pulsefeed.sourceType));queue.add(function(args){$('#source_'+args.id).animate({opacity:1},250);},150,{id:data.sources[i].id});}}
pulsefeed.sourceOffset++;api.start(false);$(el).html('load more '+pulsefeed.sourceType+'s &darr;');}else{window.location=mod_root+'/'+pulsefeed.sourceType+'s?offset='+pulsefeed.sourceOffset;}},function(data,el){window.location=mod_root+'/'+pulsefeed.sourceType+'s?offset='+pulsefeed.sourceOffset;},el);}
api.linkStream=function(){switch(pulsefeed.streamType){case'public':return'/public';case'website':return'/website/'+pulsefeed.streamWebsite;case'account':return'/account/'+pulsefeed.streamAccount;case'collection':return'/collection/'+pulsefeed.streamCollection;case'topic':return'/topic/'+pulsefeed.streamTopic;default:return'/user/'+pulsefeed.streamUser+'/'+pulsefeed.streamType;}}
api.hideStream=function(){$('.col').animate({height:'toggle'},300,function(){$('.col').html('');});}
api.showStream=function(){$('.col').css({height:'auto'});}
api.loadStream=function(el,reload){$(el).html('loading <img src="'+mod_root+'/inc/img/icons/loader.gif" alt="" />');if(reload)
this.hideStream();var link=this.linkStream();this.get(link,{offset:pulsefeed.streamOffset},function(data,el){if(data.result=='success'){if(data.stream==null){$(el).html('no more articles :(');$(el).removeClass('stream_load_more');$(el).unbind('click');$(el).bind('click',function(ev){ev.preventDefault();});$(el).addClass('disabled');return;}
api.showStream();var stream=api.buildStream(data.stream);api.renderStream(stream,data.recommends);pulsefeed.streamOffset++;api.start(false);$(el).html('load more articles &darr;');}else{window.location=mod_root+api.linkStream()+'?offset='+pulsefeed.streamOffset;}},function(data,el){window.location=mod_root+api.linkStream()+'?offset='+pulsefeed.streamOffset;},el);}
api.renderStream=function(stream,recommends){var length=0;var stream_div_id=pulsefeed.streamOffset;$('.stream_load_more').before('<div class="block">&nbsp;</div><div class="stream_'+stream_div_id+'"><div class="col col1"></div><div class="col col2"></div><div class="col col3"></div>');if(stream.col1.length>length)
length=stream.col1.length;if(stream.col2.length>length)
length=stream.col2.length;if(stream.col3.length>length)
length=stream.col3.length;for(var i=0;i<length;i++){if(stream.col1[i]!=undefined){$('.stream_'+stream_div_id+' .col1').append(template.item(stream.col1[i]));queue.add(function(args){$('#article_'+args.id).animate({opacity:1},250);},100,{id:stream.col1[i].id});}
if(stream.col2[i]!=undefined){$('.stream_'+stream_div_id+' .col2').append(template.item(stream.col2[i]));queue.add(function(args){$('#article_'+args.id).animate({opacity:1},250);},100,{id:stream.col2[i].id});}
if(stream.col3[i]!=undefined){switch(pulsefeed.streamType){case'hybrid':case'popular':case'public':$('.stream_'+stream_div_id+' .col3').append(template.item(stream.col3[i],true,'h4'));break;default:$('.stream_'+stream_div_id+' .col3').append(template.item(stream.col3[i]));}
queue.add(function(args){$('#article_'+args.id).animate({opacity:1},250);},100,{id:stream.col3[i].id});}}}
api.buildStream=function(items){var cols=new Array();cols[1]=new Array();cols[2]=new Array();cols[3]=new Array();switch(pulsefeed.streamType){case'hybrid':case'popular':case'public':if(items.length>2){var length=items.length;var third=Math.round(length / 3);for(var i=length-third;i<length;i++){items[i].short_description=items[i].shorter_description;cols[3][cols[3].length]=items[i];}
var iscol2=false;for(var i=0;i<length-third;i++){if(iscol2){cols[2][cols[2].length]=items[i];}else{cols[1][cols[1].length]=items[i];}
iscol2=!iscol2;}
break;}
default:var col=1;for(var i=0;i<items.length;i++){cols[col][cols[col].length]=items[i];col++;if(col>3)
col=1;}}
var r={};r.col1=cols[1];r.col2=cols[2];r.col3=cols[3];return r;}
var template={};template.item=function(item,no_image,header){var long=true;if(cookie.get('hide_images'))
no_image=true;var been_image=false;var is_tweet=false;var is_post=false;for(var i=0;i<item.refs.length;i++)
if(item.refs[i].source_type=='twitter'&&item.refs[i].source_data.text)
is_tweet=i;else if(item.refs[i].source_type=='facebook'&&item.refs[i].source_data.text)
is_post=i;var r='<div class="item" id="article_'+item.id+'" style="opacity:0;">';r+=header?'<'+header+'>':'<h3>';r+='<a href="'+mod_root+'/article/'+item.id+'" class="article_link" rel="nofollow">'+item.title+'</a>';r+=header?'</'+header+'>':'</h3>';if(!no_image&&item.image_wide_big&&cookie.get('two_col')){been_image=true;r+='<a href="'+mod_root+'/article/'+item.id+'" class="article_link" rel="nofollow">';r+='<img class="thumb" src="'+mod_root+'/'+item.image_wide_big+'" alt="'+item.title+'" />';r+='</a>';}else if(!no_image&&item.image_wide){been_image=true;r+='<a href="'+mod_root+'/article/'+item.id+'" class="article_link" rel="nofollow">';r+='<img class="thumb" src="'+mod_root+'/'+item.image_wide+'" alt="'+item.title+'" />';r+='</a>';}
r+='<p'+(been_image||is_tweet||is_post?'':' class="wide"')+'>';r+=item.short_description?html_entity_decode(item.short_description):html_entity_decode(item.description);r+='<span class="extended hidden">'+(item.extended_description?html_entity_decode(item.extended_description):'')+'</span>';switch(item.type){case'video':break;default:r+='... <a href="'+mod_root+'/article/'+item.id+'" class="article_link" rel="nofollow">read article&nbsp;&rarr;</a>';}
r+='</p>';if(!been_image&&is_tweet){r+='<div class="tweet">';r+='<img src="http://tweeter.fdev.in/'+item.refs[is_tweet].source_id+'" alt="" />';r+='<a href="'+mod_root+'/account/twitter/'+item.refs[is_tweet].source_id+'">@'+item.refs[is_tweet].source_title+'</a>';r+='<p>'+item.refs[is_tweet].source_data.text+'</p>';r+='</div>';}else if(!been_image&&is_post){r+='<div class="tweet">';r+='<img src="http://tweeter.fdev.in/'+item.refs[is_post].source_id+'" alt="" />';r+='<a href="'+mod_root+'/account/twitter/'+item.refs[is_post].source_id+'">'+item.refs[is_post].source_title+'</a>';r+='<p>'+item.refs[is_post].source_data.text+'</p>';r+='</div>';}
r+='<ul class="meta">';for(var i=0;i<item.refs.length;i++){var link=mod_root+'/';switch(item.refs[i].source_type){case'website':case'public':link+='website'+'/'+item.refs[i].source_id;break;case'like':link+='user'+'/'+item.refs[i].source_id;break;case'facebook':case'twitter':link+='account/'+item.refs[i].source_type+'/'+item.refs[i].source_id;break;case'topic':link+='topic/'+item.refs[i].source_id;break;case'share':link+='user/'+item.refs[i].source_id;break;default:link='#';}
r+='<li class="tip hover big"><span>';switch(item.refs[i].source_type){case'twitter':case'facebook':r+='<img src="'+(item.refs[i].source_type=='twitter'?'http://tweeter.fdev.in/'+item.refs[i].source_id:'http://graph.facebook.com/'+item.refs[i].source_id+'/picture')+'" class="avatar" />';r+='<em class="big">"'+(item.refs[i].source_data.text?html_entity_decode(item.refs[i].source_data.text):'No post / tweet located')+'</em>';if(item.refs[i].source_data.postid){r+='<a target="_blank" href=';r+=item.refs[i].source_type=='twitter'?'http://twitter.com/'+item.refs[i].source_title+'/status/'+item.refs[i].source_data.postid:'http://facebook.com/'+item.refs[i].source_id+'/posts/'+item.refs[i].source_data.postid;r+='" class="button right '+item.refs[i].source_type+'">View '+(item.refs[i].source_type=='twitter'?'Tweet':'Post')+'</a>';r+='<a target="_blank" href="';r+=item.refs[i].source_type=='twitter'?'http://twitter.com/'+item.refs[i].source_title:'http://facebook.com/'+item.refs[i].source_id;r+='" class="button right green">Profile</a>';}
break;default:r+='<ul>';r+='<li><small class="edit">author</small> '+(item.author?'Unknown':item.autho)+'</li>';r+='<li><small class="edit">date</small> '+item.time+'</li>';r+='<li><small class="edit">subscribers</small> '+(item.refs[i].source_data.subscribers?item.refs[i].source_data.subscribers:0)+'</li>';r+='</ul>';if(item.refs[i].source_type=='website'){r+='<form action="'+mod_root+'/process/website-'+(item.refs[i].subscribed?'un':'')+'subscribe" method="post" id="subunsub" class="website_subscribe">';r+='<input type="hidden" name="mod_token" value="'+mod_token+'" />';r+='<input type="hidden" name="website_id" value="'+item.refs[i].source_id+'" />';r+='<input type="submit" value="'+(item.refs[i].subscribed?'Unsubscribe':'+ Subscribe')+'" class="button '+(item.refs[i].subscribed?'red':'green')+'" />';r+='</form>';}else if(item.refs[i].source_type=='topic'){r+='<form action="'+mod_root+'/process/topic-'+(item.refs[i].subscribed?'un':'')+'subscribe" method="post" id="subunsub" class="topic_subscribe">';r+='<input type="hidden" name="mod_token" value="'+mod_token+'" />';r+='<input type="hidden" name="website_id" value="'+item.refs[i].source_id+'" />';r+='<input type="submit" value="'+(item.refs[i].subscribed?'Unsubscribe':'+ Subscribe')+'" class="button '+(item.refs[i].subscribed?'red':'green')+'" />';r+='</form>';}else if(item.refs[i].source_type=='share'){r+='<form action="'+mod_root+'/process/'+(item.refs[i].subscribed?'un':'')+'follow" method="post" id="subunsub" class="user_follow">';r+='<input type="hidden" name="mod_token" value="'+mod_token+'" />';r+='<input type="hidden" name="website_id" value="'+item.refs[i].source_id+'" />';r+='<input type="submit" value="'+(item.refs[i].subscribed?'Unsubscribe':'+ Follow')+'" class="button '+(item.refs[i].subscribed?'red':'green')+'" />';r+='</form>';}}
switch(item.refs[i].source_type){case'twitter':case'facebook':case'website':case'topic':r+='<img src="'+mod_root+'/inc/img/icons/share/'+item.refs[i].source_type+'.png" />';}
r+='<strong><a href="'+link+'">';switch(item.refs[i].source_type){case'twitter':r+='@';break;case'topic':r+='Topic: ';break;}
r+=item.refs[i].source_title+'</a></strong><small>';switch(item.refs[i].source_type){case'public':r+='Public source';break;case'website':case'topic':if(pulsefeed.streamUser==mod_userid){r+=item.refs[i].subscribed?'You are subscribed':'Not subscribed';}else{r+=pulsefeed.streamUsername+' is subscribed';}
break;case'share':if(pulsefeed.streamUser==mod_userid){r+=item.refs[i].subscribed?'You are subscribed':'Not subscribed';}else{r+=pulsefeed.streamUsername+' is subscribed';}
break;case'facebook':r+='You are subscribed';break;case'twitter':r+=(pulsefeed.streamUser==mod_userid?'You follow':pulsefeed.streamUsername+'follows')+' them';break;default:r+='Unknown';}
r+='</small><span></span></span>';r+='<a class="link" href="'+link+'">';switch(item.refs[i].source_type){case'public':case'website':r+='<img class="icon" src="http://favicon.fdev.in/'+item.refs[i].source_data.domain+'" alt="" />';break;case'twitter':r+='<img class="icon" src="http://tweeter.fdev.in/'+item.refs[i].source_id+'" alt="" />';break;case'facebook':r+='<img class="icon" src="http://graph.facebook.com/'+item.refs[i].source_id+'/picture" alt="" />';break;case'topic':r+='#';break;}
r+=item.refs[i].source_title+'</a></li>';}
r+='</ul>';r+='<div class="meta">';if(mod_userid>0){if(item.unread&&item.unread==1&&mod_userid==pulsefeed.streamUser){r+='<form action="'+mod_root+'/process/article-hide" method="post" class="hide_form">';r+='<input type="hidden" name="article_id" value="'+item.id+'" />';r+='<input type="hidden" name="mod_token" value="'+mod_token+'" />';r+='<input type="submit" value="Hide" class="meta" />';r+='</form> - ';}
r+='<span class="collect"><a class="collect_button tip mini always" href="'+mod_root+'/article/'+item.id+'/collect" data-articleid="'+item.id+'">Collect</a></span> - ';}
r+='<form action="'+mod_root+'/process/article-share" method="post" class="share_form">';r+='<input type="hidden" name="article_id" value="'+item.id+'" />';r+='<input type="hidden" name="mod_token" value="'+mod_token+'" />';r+='<input type="hidden" name="twitter_links" value="'+item.twitter_links+'" />';r+='<input type="hidden" name="facebook_shares" value="'+item.facebook_shares+'" />';r+='<input type="submit" value="Share" class="meta" />';r+='<span class="share"></span>';r+='</form>';r+='<span class="time"> - '+item.time_ago+'</span>';r+='</div>';r+='</div><!--end item-->';return r;}
template.source=function(source,type){var r='<div class="source" style="opacity:0;" id="source_'+source.id+'">';r+='<h2><a href="'+mod_root+'/'+type+'/'+source.id+'">';r+=type=='website'?'<img class="favicon" src="http://favicon.fdev.in/'+source.site_domain+'" alt="" /> ':'';r+=source.title;r+='</a>';r+=type=='website'?'<a href="'+source.site_url+'" class="edit" target="_blank">'+source.site_url+'</a>':'';r+=type=='collection'?'<a href="'+mod_root+'/user/'+source.user_id+'" class="edit">'+(source.owned?'your collection':source.username)+'</span></a>':'';r+='</h2>';r+='<div class="images"><div class="img one">';if(source.articles[0]){r+='<a href="'+mod_root+'/article/'+source.articles[0].id+'">';r+='<span class="title">'+source.articles[0].title+'</span><img src="'+mod_root+'/'+source.articles[0].image_thumb+'" alt="" />';r+='</a>';}
r+='</div><div class="img two">';if(source.articles[1]){r+='<a href="'+mod_root+'/article/'+source.articles[1].id+'">';r+='<span class="title">'+source.articles[1].title+'</span><img src="'+mod_root+'/'+source.articles[1].image_thumb+'" alt="" />';r+='</a>';}
r+='</div><div class="img three">';if(source.articles[2]){r+='<a href="'+mod_root+'/article/'+source.articles[2].id+'">';r+='<span class="title">'+source.articles[2].title+'</span><img src="'+mod_root+'/'+source.articles[2].image_thumb+'" alt="" />';r+='</a>';}
r+='</div></div>';r+='<ul class="meta">';switch(type){case'topic':case'website':r+='<li><small class="edit">subscribers</small>'+source.subscribers+'</li>';r+='<li><small class="edit">articles</small>'+source.article_count+'</li>';break;case'collection':r+='<li><small class="edit">views</small>'+source.views+'</li>';r+='<li><small class="edit">articles</small>'+source.article_count+'</li>';break;}
r+='</ul>';switch(type){case'topic':case'website':r+='<form method="post" action="'+mod_root+'/process/'+type+'-'+(source.subscribed?'unsubscribe':'subscribe')+'" class="'+type+'_subscribe">';r+='<input type="submit" class="button '+(source.subscribed?'red':'green')+'" value="'+(source.subscribed?'Unsubscribe':'+ Subscribe')+'" />';r+='<input type="hidden" name="'+type+'_id" value="'+source.id+'" />';r+='<input type="hidden" name="mod_token" value="'+mod_token+'" />';r+='</form>';break;case'collection':r+='<form method="post" action="'+mod_root+'/process/collection-delete">';r+='<a href="'+mod_root+'/collection/'+source.id+'" class="button blue">View</a>';r+=source.owned?'<input type="submit" class="button red" value="Delete" />':'';r+='<input type="hidden" name="'+type+'_id" value="'+source.id+'" />';r+='<input type="hidden" name="mod_token" value="'+mod_token+'" />';r+='</form>';break;}
r+='</div><!--end source-->';return r;}
var design={};design.start=function(){$('.top_link').bind('click',function(ev){ev.preventDefault();design.scrollTo(0);});$('.article_link').bind('click',function(ev){localStorage.pulsefeedprevScroll=$('body').scrollTop();});if(pulsefeed.stream&&localStorage.pulsefeedprevScroll>0){this.scrollTo(localStorage.pulsefeedprevScroll-200);localStorage.pulsefeedprevScroll=0;}
$('input[type=submit]').bind('click',function(ev){$(ev.target).addClass('disabled');});if(pulsefeed.streamType&&$(window).width()<=1280&&!cookie.get('auto_columns')&&!cookie.get('two_col')){api.columnToggle($('.stream_column_toggle'));cookie.set('auto_columns',true);cookie.set('two_col',true);}}
design.scrollTo=function(px){$('html').animate({scrollTop:px},300);$('body').animate({scrollTop:px},300);}
var queue={};queue.items=new Array();queue.timer=0;queue.pos=0;queue.start=function(){setInterval(this.process,50);}
queue.add=function(func,time,args){this.items[this.items.length]={time:time,func:func,args:args};}
queue.process=function(){if(queue.items[queue.pos]==undefined)
return;if(queue.timer<=0){queue.items[queue.pos].func(queue.items[queue.pos].args);queue.timer=queue.items[queue.pos].time;queue.pos++;}
queue.timer-=50;}
var cookie={cookie_id:'pulsefeed_',cookie_domain:'.'+window.location.host,set:function(key,value){return $.cookie(this.cookie_id+key,value,{expires:365,path:'/',domain:this.cookie_domain});},get:function(key){return $.cookie(this.cookie_id+key);},delete:function(key){$.cookie(this.cookie_id+key,false,{expires:-1,path:'/',domain:this.cookie_domain});}};function html_entity_decode(string,quote_style){var hash_map={},symbol='',tmp_str='',entity='';tmp_str=string.toString();if(false===(hash_map=this.get_html_translation_table('HTML_ENTITIES',quote_style))){return false;}
delete(hash_map['&']);hash_map['&']='&amp;';for(symbol in hash_map){entity=hash_map[symbol];tmp_str=tmp_str.split(entity).join(symbol);}
tmp_str=tmp_str.split('&#039;').join("'");return tmp_str;}
function get_html_translation_table(table,quote_style){var entities={},hash_map={},decimal;var constMappingTable={},constMappingQuoteStyle={};var useTable={},useQuoteStyle={};constMappingTable[0]='HTML_SPECIALCHARS';constMappingTable[1]='HTML_ENTITIES';constMappingQuoteStyle[0]='ENT_NOQUOTES';constMappingQuoteStyle[2]='ENT_COMPAT';constMappingQuoteStyle[3]='ENT_QUOTES';useTable=!isNaN(table)?constMappingTable[table]:table?table.toUpperCase():'HTML_SPECIALCHARS';useQuoteStyle=!isNaN(quote_style)?constMappingQuoteStyle[quote_style]:quote_style?quote_style.toUpperCase():'ENT_COMPAT';if(useTable!=='HTML_SPECIALCHARS'&&useTable!=='HTML_ENTITIES'){throw new Error("Table: "+useTable+' not supported');}
entities['38']='&amp;';if(useTable==='HTML_ENTITIES'){entities['160']='&nbsp;';entities['161']='&iexcl;';entities['162']='&cent;';entities['163']='&pound;';entities['164']='&curren;';entities['165']='&yen;';entities['166']='&brvbar;';entities['167']='&sect;';entities['168']='&uml;';entities['169']='&copy;';entities['170']='&ordf;';entities['171']='&laquo;';entities['172']='&not;';entities['173']='&shy;';entities['174']='&reg;';entities['175']='&macr;';entities['176']='&deg;';entities['177']='&plusmn;';entities['178']='&sup2;';entities['179']='&sup3;';entities['180']='&acute;';entities['181']='&micro;';entities['182']='&para;';entities['183']='&middot;';entities['184']='&cedil;';entities['185']='&sup1;';entities['186']='&ordm;';entities['187']='&raquo;';entities['188']='&frac14;';entities['189']='&frac12;';entities['190']='&frac34;';entities['191']='&iquest;';entities['192']='&Agrave;';entities['193']='&Aacute;';entities['194']='&Acirc;';entities['195']='&Atilde;';entities['196']='&Auml;';entities['197']='&Aring;';entities['198']='&AElig;';entities['199']='&Ccedil;';entities['200']='&Egrave;';entities['201']='&Eacute;';entities['202']='&Ecirc;';entities['203']='&Euml;';entities['204']='&Igrave;';entities['205']='&Iacute;';entities['206']='&Icirc;';entities['207']='&Iuml;';entities['208']='&ETH;';entities['209']='&Ntilde;';entities['210']='&Ograve;';entities['211']='&Oacute;';entities['212']='&Ocirc;';entities['213']='&Otilde;';entities['214']='&Ouml;';entities['215']='&times;';entities['216']='&Oslash;';entities['217']='&Ugrave;';entities['218']='&Uacute;';entities['219']='&Ucirc;';entities['220']='&Uuml;';entities['221']='&Yacute;';entities['222']='&THORN;';entities['223']='&szlig;';entities['224']='&agrave;';entities['225']='&aacute;';entities['226']='&acirc;';entities['227']='&atilde;';entities['228']='&auml;';entities['229']='&aring;';entities['230']='&aelig;';entities['231']='&ccedil;';entities['232']='&egrave;';entities['233']='&eacute;';entities['234']='&ecirc;';entities['235']='&euml;';entities['236']='&igrave;';entities['237']='&iacute;';entities['238']='&icirc;';entities['239']='&iuml;';entities['240']='&eth;';entities['241']='&ntilde;';entities['242']='&ograve;';entities['243']='&oacute;';entities['244']='&ocirc;';entities['245']='&otilde;';entities['246']='&ouml;';entities['247']='&divide;';entities['248']='&oslash;';entities['249']='&ugrave;';entities['250']='&uacute;';entities['251']='&ucirc;';entities['252']='&uuml;';entities['253']='&yacute;';entities['254']='&thorn;';entities['255']='&yuml;';}
if(useQuoteStyle!=='ENT_NOQUOTES'){entities['34']='&quot;';}
if(useQuoteStyle==='ENT_QUOTES'){entities['39']='&#39;';}
entities['60']='&lt;';entities['62']='&gt;';for(decimal in entities){if(entities.hasOwnProperty(decimal)){hash_map[String.fromCharCode(decimal)]=entities[decimal];}}
return hash_map;}